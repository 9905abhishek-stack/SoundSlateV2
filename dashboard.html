<!DOCTYPE html>
<html lang="en" class="h-full"> <!-- Defaulted to Light Theme (no 'dark' class initially) -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundSlate - Dashboards</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

    <!-- Use v5.5.2 for solid icons --><script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

    <script>
        // Configure Tailwind for dark mode and custom colors
        tailwind.config = {
            darkMode: 'class', // Enable class-based dark mode
            theme: {
                extend: {
                    colors: {
                        'accent': '#38BDF8', // sky-400
                        'accent-dark': '#0EA5E9', // sky-500
                        'bg-light': '#F9FAFB', // gray-50
                        // Dark mode colors (defined via CSS variables below for easier JS toggle)
                    }
                }
            }
        }
    </script>

    <style>
        /* Light mode variables (default) */
        :root {
            --bg-primary: #F9FAFB; /* bg-light / gray-50 */
            --bg-secondary: #ffffff; /* white */
            --bg-tertiary: #F3F4F6; /* gray-100 */
            --bg-muted: #E5E7EB; /* gray-200 */
            --text-primary: #111827; /* gray-900 */
            --text-secondary: #374151; /* gray-700 */
            --text-muted: #6B7280; /* gray-500 */
            --border-color: #E5E7EB; /* gray-200 */
            --accent: #38BDF8;
            --accent-dark: #0EA5E9;
            --accent-contrast: #ffffff;
            --icon-color: #6B7280; /* gray-500 */
            --icon-hover-bg: var(--accent);
            --icon-hover-text: #ffffff;
            --chart-grid-color: rgba(0, 0, 0, 0.1);
        }

        /* Dark mode variables */
        .dark {
            --bg-primary: #0f172a; /* slate-900 */
            --bg-secondary: #1e293b; /* slate-800 */
            --bg-tertiary: #334155; /* slate-700 */
            --bg-muted: #475569; /* slate-600 */
            --text-primary: #f8fafc; /* slate-50 */
            --text-secondary: #cbd5e1; /* slate-300 */
            --text-muted: #94a3b8; /* slate-400 */
            --border-color: #475569; /* slate-600 */
            --accent: #38BDF8; /* sky-400 */
            --accent-dark: #7dd3fc; /* sky-300 */
            --accent-contrast: #0f172a; /* slate-900 for text on accent */
            --icon-color: #94a3b8; /* slate-400 */
            --icon-hover-bg: var(--accent);
            --icon-hover-text: #0f172a; /* slate-900 */
            --chart-grid-color: rgba(255, 255, 255, 0.1);
        }

        /* Apply variables */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        header { background-color: var(--bg-secondary); border-bottom-color: var(--border-color); }
        main { background-color: var(--bg-primary); }
        .bg-white { background-color: var(--bg-secondary); }
        .bg-gray-50 { background-color: var(--bg-tertiary); }
        .bg-gray-100 { background-color: var(--bg-tertiary); } /* Re-map gray-100 */
        .bg-gray-200 { background-color: var(--bg-muted); }
        .text-gray-900 { color: var(--text-primary); }
        .text-gray-800 { color: var(--text-primary); } /* Re-map gray-800 */
        .text-gray-700 { color: var(--text-secondary); }
        .text-gray-600 { color: var(--text-muted); }
        .text-gray-500 { color: var(--icon-color); }
        .text-accent { color: var(--accent); }
        .hover\:text-accent-dark:hover { color: var(--accent-dark); }
        .bg-accent { background-color: var(--accent); color: var(--accent-contrast); }
        .hover\:bg-accent-dark:hover { background-color: var(--accent-dark); color: var(--accent-contrast); }
        .border, .border-t, .border-b, .border-l, .border-r { border-color: var(--border-color); }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .dark .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2); } /* Darker shadow */
        .hover\:bg-gray-100:hover { background-color: var(--bg-tertiary); }
        .hover\:text-gray-900:hover { color: var(--text-primary); }
        input, select, textarea { background-color: var(--bg-secondary); color: var(--text-primary); border-color: var(--border-color); }
        input::placeholder, textarea::placeholder { color: var(--text-muted); }

        /* DARK MODE FIX: Ensure select options are legible in the reports dropdowns */
        .dark select option {
            background-color: var(--bg-secondary); /* Dark background for dropdown options */
            color: var(--text-primary);           /* Light text for dropdown options */
        }
        
        /* Icon specific hover styles */
        .text-gray-500.hover\:text-white:hover { color: var(--icon-hover-text); }
        .hover\:bg-accent:hover { background-color: var(--icon-hover-bg); }


        .page { display: none; }
        .page.active { display: block; }

        /* Toast Notification styles */
        .toast-notification {
            @apply fixed top-5 right-5 bg-blue-600 text-white px-6 py-4 rounded-lg shadow-xl z-[100] transform translate-x-full transition-transform duration-300 ease-out;
        }
        .toast-notification.show { @apply translate-x-0; }

        /* Chat Bubble styles */
        .chat-bubble { @apply px-4 py-2 rounded-lg max-w-xs; }
        .chat-bubble-user { @apply bg-accent text-white self-end rounded-br-none; color: var(--accent-contrast); }
        .chat-bubble-ai { background-color: var(--bg-muted); color: var(--text-secondary); @apply self-start rounded-bl-none; }
        .chat-bubble-ai.thinking { @apply italic; color: var(--text-muted); }

        /* Chart Legend */
        .chart-legend-item { @apply flex items-center text-sm; color: var(--text-muted); }
        .chart-legend-dot { @apply w-3 h-3 rounded-full mr-2; }

        /* Starry backgrounds remain the same */
        .bg-starry-gradient { background-image: linear-gradient(to right, #2c3e50, #000000); }
        .bg-starry-night { background-image: url('https://images.unsplash.com/photo-1502134249126-9f3755a50d78?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8fHx8fA%3D%3D'); background-size: cover; background-position: center; }

        /* Nav links */
        .nav-link.active { @apply bg-starry-night text-white rounded-lg shadow-md; background-size: cover; background-position: center; text-shadow: 0 0 6px rgba(255, 255, 255, 0.7); }
        .nav-link.inactive { color: var(--text-muted); }
        .nav-link.inactive:hover { background-color: var(--bg-tertiary); color: var(--text-primary); }


        /* Logo styles */
        .logo-container { display: flex; align-items: center; gap: 0.5rem; }
        /* Increased font weight for the S to be 'sleeky skype bold' */
        .soundslate-logo-text { display: inline-block; font-size: 1.5rem; line-height: 2rem; font-weight: 800; color: var(--accent); vertical-align: middle; }
        /* Style for active mode button */
        .toggle-button.active { @apply bg-accent text-white shadow-md; }
        .toggle-button.inactive { background-color: var(--bg-muted); color: var(--text-secondary); }

        /* File Input & Recording */
        .file-input-button { @apply inline-flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium bg-white hover:bg-gray-50 cursor-pointer; color: var(--text-secondary); background-color: var(--bg-secondary); border-color: var(--border-color); }
        .file-input-button:hover { background-color: var(--bg-tertiary); }
        .recording-dot { @apply w-3 h-3 rounded-full bg-red-500 animate-pulse; }

        /* Notification Badge & Dropdown */
        .notification-badge-container { @apply relative; }
        .notification-badge { @apply absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-white; }
        /* A default style for all notification modals to ensure theme colors are used */
        #notification-modal .bg-white { background-color: var(--bg-secondary); }
        #notification-modal .border-b { border-color: var(--border-color); }
        #notification-modal .text-gray-900 { color: var(--text-primary); }
        #notification-modal .text-gray-600 { color: var(--text-muted); }
        #notification-modal .bg-gray-50 { background-color: var(--bg-tertiary); }
        #notification-modal .hover\:bg-gray-100:hover { background-color: var(--bg-muted); }

        /* Report Modal Wrapping */
        #report-content { white-space: normal; word-wrap: break-word; overflow-wrap: break-word; }
        #report-content p, #report-content li, #report-content strong, #report-content em { white-space: normal; word-wrap: break-word; overflow-wrap: break-word; }
        /* Markdown generated content styles */
        #generated-content-results h1, #generated-content-results h2, #generated-content-results h3 { color: var(--text-primary); margin-bottom: 0.5rem; font-weight: 600; }
        #generated-content-results p { color: var(--text-secondary); margin-bottom: 1rem; }
        #generated-content-results ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary); }
        #generated-content-results li { margin-bottom: 0.5rem; }


        /* Theme Toggle Switch */
        .theme-switch-wrapper { @apply flex items-center; }
        .theme-switch { @apply relative inline-block w-12 h-6 cursor-pointer; } /* Increased width to 12 */
        .theme-switch input { @apply opacity-0 w-0 h-0; }
        .slider { 
            @apply absolute top-0 left-0 right-0 bottom-0 rounded-full transition duration-300; 
            background-color: var(--bg-muted); 
            box-shadow: inset 0 0 4px rgba(0,0,0,0.2);
        }
        .slider:before { 
            @apply absolute content-[''] h-4 w-4 left-1 bottom-1 rounded-full transition duration-300; 
            background-color: white; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }
        /* Style for the sun icon */
        .slider ion-icon.sun {
            @apply absolute text-yellow-500 w-4 h-4;
            top: 5px;
            right: 4px;
            transition: opacity 0.2s;
        }
         /* Style for the moon icon */
        .slider ion-icon.moon {
            @apply absolute text-sky-200 w-4 h-4;
            top: 5px;
            left: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        /* CHECKED STATE */
        input:checked + .slider { 
            background-color: var(--accent); 
        }
        input:checked + .slider:before { 
            @apply transform translate-x-6; /* Pushed further right */
        }
        input:checked + .slider ion-icon.sun {
            opacity: 0;
        }
        input:checked + .slider ion-icon.moon {
            opacity: 1;
        }

    </style>
</head>
<body class="min-h-full"> <!-- Body class controlled by JS -->

    <!-- PAGE 1: HOME DASHBOARD -->
    <div id="page-home" class="page active">
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Logo and Nav -->
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <!-- User Menu and Icons -->
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div id="user-avatar-home" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                            <span id="user-name-home" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        </div>
                        <div class="flex items-center space-x-1 relative"> <!-- Added relative for dropdown positioning -->
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications">
                                <ion-icon name="notifications-outline" class="text-2xl"></ion-icon>
                                <span class="notification-badge"></span>
                            </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <!-- Welcome Banner -->
                <div class="relative bg-starry-night text-white p-6 md:p-8 rounded-xl shadow-md mb-8 flex flex-col md:flex-row justify-between items-center overflow-hidden">
                    <div class="absolute inset-0 bg-black opacity-40 z-0"></div>
                    <div class="relative z-10 mb-4 md:mb-0">
                        <h1 id="welcome-banner" class="text-3xl font-bold">Welcome back, Abhishek!</h1>
                        <p class="mt-1 text-lg text-sky-100">Track your child's learning journey with powerful insights.</p>
                    </div>
                    <div class="relative z-10 flex flex-col sm:flex-row gap-3">
                        <button onclick="navigateTo('page-progress')" class="bg-accent text-white font-semibold px-5 py-3 rounded-lg shadow-md hover:bg-accent-dark transition duration-200 flex items-center justify-center gap-2"> <ion-icon name="bar-chart-outline" class="text-xl"></ion-icon> View Dashboard </button>
                        <button onclick="navigateTo('page-assessment')" class="bg-white/20 text-white border-2 border-white font-semibold px-5 py-3 rounded-lg shadow-md hover:bg-white/30 transition duration-200 flex items-center justify-center gap-2"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Start Assessment </button>
                    </div>
                </div>

                <!-- Stat Cards -->
                <h2 class="text-2xl font-semibold text-gray-900 mb-4">Your Child's Progress Overview </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Cards remain here -->
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4"> <div class="p-3 rounded-full bg-sky-100 text-sky-600"><ion-icon name="checkmark-done-circle-outline" class="text-3xl"></ion-icon></div> <div><div class="text-3xl font-bold text-gray-900">27</div><div class="text-sm text-gray-500">Tasks Completed</div></div> </div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4"> <div class="p-3 rounded-full bg-sky-100 text-sky-600"><ion-icon name="time-outline" class="text-3xl"></ion-icon></div> <div><div class="text-3xl font-bold text-gray-900">2.5h</div><div class="text-sm text-gray-500">Study Time Today</div></div> </div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4"> <div class="p-3 rounded-full bg-sky-100 text-sky-600"><ion-icon name="trending-up-outline" class="text-3xl"></ion-icon></div> <div><div class="text-3xl font-bold text-gray-900">85%</div><div class="text-sm text-gray-500">Success Rate</div></div> </div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center space-x-4"> <div class="p-3 rounded-full bg-green-100 text-green-600"><ion-icon name="arrow-up-circle-outline" class="text-3xl"></ion-icon></div> <div><div class="text-3xl font-bold text-green-600">+12%</div><div class="text-sm text-gray-500">Weekly Improvement</div></div> </div>
                </div>
                
                <!-- New Grid for Features and Notifications -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- 1. Key Features (lg:col-span-2) -->
                    <div class="lg:col-span-2">
                        <h2 class="text-2xl font-semibold text-gray-900 mb-4">Key Features</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Feature Cards... (content unchanged) -->
                            <div class="bg-white p-6 rounded-xl shadow-md"> <div class="p-3 rounded-full bg-sky-100 text-sky-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="analytics-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">Real-time Tracking</h3> <p class="text-gray-600 text-sm">Monitor progress with live updates.</p> </div>
                            <div class="bg-white p-6 rounded-xl shadow-md"> <div class="p-3 rounded-full bg-sky-100 text-sky-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="alert-circle-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">Early Warnings</h3> <p class="text-gray-600 text-sm">Get alerts for specific struggles.</p> </div>
                            <div class="bg-white p-6 rounded-xl shadow-md"> <div class="p-3 rounded-full bg-sky-100 text-sky-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="bulb-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">AI Insights</h3> <p class="text-gray-600 text-sm">Receive personalized recommendations.</p> </div>
                            <div class="bg-white p-6 rounded-xl shadow-md"> <div class="p-3 rounded-full bg-sky-100 text-sky-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="people-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">Teacher Connect</h3> <p class="text-gray-600 text-sm">Direct communication channel.</p> </div>
                            <div class="bg-white p-6 rounded-xl shadow-md"> <div class="p-3 rounded-full bg-sky-100 text-sky-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="phone-portrait-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">Mobile Access</h3> <p class="text-gray-600 text-sm">Stay connected anywhere.</p> </div>
                            <div class="bg-white p-6 rounded-xl shadow-md"> <div class="p-3 rounded-full bg-sky-100 text-sky-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="document-text-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">Detailed Reports</h3> <p class="text-gray-600 text-sm">Generate comprehensive reports.</p> </div>
                        </div>
                    </div>
                    
                    <!-- 2. Recent Notifications (lg:col-span-1) -->
                    <div>
                        <h2 class="text-2xl font-semibold text-gray-900 mb-4">Recent Notifications</h2>
                        <div class="bg-white p-6 rounded-xl shadow-md h-full flex flex-col justify-between">
                            <ul class="space-y-4">
                                <li class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                    <ion-icon name="trending-up-outline" class="text-xl text-green-600 mt-1 flex-shrink-0"></ion-icon>
                                    <div>
                                        <p class="font-medium text-gray-900">Reading speed increased!</p>
                                        <p class="text-xs text-gray-600">Akash is now reading at 88 WPM. 2h ago</p>
                                    </div>
                                </li>
                                <li onclick="navigateTo('page-reports')" class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
                                    <ion-icon name="document-text-outline" class="text-xl text-blue-600 flex-shrink-0 mt-1"></ion-icon>
                                    <div>
                                        <p class="font-medium text-gray-900">New weekly report available.</p>
                                        <p class="text-xs text-gray-600">Summary for Oct 19-25 is ready. Yesterday</p>
                                    </div>
                                </li>
                                <li onclick="navigateTo('page-insights')" class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
                                    <ion-icon name="bulb-outline" class="text-xl text-yellow-600 flex-shrink-0 mt-1"></ion-icon>
                                    <div>
                                        <p class="font-medium text-gray-900">Focus Area: Complex Words</p>
                                        <p class="text-xs text-gray-600">AI suggests practice. 3d ago</p>
                                    </div>
                                </li>
                            </ul>
                            <button onclick="document.getElementById('notification-modal').classList.remove('hidden')" class="w-full text-sm font-semibold text-accent hover:underline mt-4 py-2 border-t pt-4 border-gray-200">View All Notifications</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PAGE 2: PROGRESS DASHBOARD -->
    <div id="page-progress" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm sticky top-0 z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2"> <div id="user-avatar-progress" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div> <span id="user-name-progress" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span> </div>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Sub-Header Banner (content unchanged) -->
            <div class="bg-starry-gradient text-white"> <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col md:flex-row justify-between items-center"> <div> <h1 id="progress-welcome" class="text-2xl font-bold">Hi Abhishek!</h1> <p class="text-sm text-sky-100">Let's check your child's reading & comprehension progress.</p> </div> <div class="flex items-center space-x-4 mt-4 md:mt-0"> <div class="flex items-center space-x-2"> <div class="p-2 bg-white/20 rounded-lg"> <ion-icon name="book-outline" class="text-2xl"></ion-icon> </div> <div> <div class="text-xl font-bold">85 WPM</div> <div class="text-xs text-sky-100">Reading Speed</div> </div> </div> <div class="flex items-center space-x-2"> <div class="p-2 bg-white/20 rounded-lg"> <ion-icon name="checkmark-done-outline" class="text-2xl"></ion-icon> </div> <div> <div class="text-xl font-bold">95%</div> <div class="text-xs text-sky-100">Accuracy</div> </div> </div> <div class="flex items-center space-x-2"> <div class="p-2 bg-white/20 rounded-lg"> <ion-icon name="chatbox-ellipses-outline" class="text-2xl"></ion-icon> </div> <div> <div class="text-xl font-bold">80%</div> <div class="text-xs text-sky-100">Comprehension</div> </div> </div> </div> </div> </div>
        </header>
        
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Main content grid -->
            <div class="px-4 py-6 sm:px-0"> 
                <!-- Changed to a 2-column layout (lg:grid-cols-2) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"> 
                    
                    <!-- TOP ROW -->
                    <!-- TOP LEFT: Skill Progress -->
                    <div id="skill-progress-container" class="bg-white p-6 rounded-xl shadow-md"> 
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Skill Progress</h3> 
                        <div id="skill-progress-bars" class="space-y-5">
                            <!-- Content injected by renderSkillProgress() -->
                        </div> 
                    </div>

                    <!-- TOP RIGHT: Daily Practice Minutes (Chart) -->
                    <div class="bg-white p-6 rounded-xl shadow-md"> 
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Daily Practice Minutes (Past Week)</h3> 
                        <div class="chart-container relative w-full h-56"> 
                            <canvas id="subjectChart"></canvas> 
                        </div> 
                        <p class="text-sm text-gray-500 mt-4">Total time this week: ~4h 30m</p>
                    </div> 

                </div>
                
                <!-- MIDDLE ROW (Activities & Time Spent) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6"> 
                    <!-- BOTTOM LEFT: Recent Activities -->
                    <div class="bg-white p-6 rounded-xl shadow-md"> 
                        <div class="flex justify-between items-center mb-4"> 
                            <h3 class="text-xl font-semibold text-gray-900">Recent Activities</h3> 
                            <a href="#" class="text-sm font-medium text-accent hover:underline">View All</a> 
                        </div> 
                        <ul class="space-y-4"> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"> 
                                <div class="flex items-center space-x-3"> 
                                    <div class="p-2 rounded-full bg-green-100 text-green-600"><ion-icon name="book-outline" class="text-xl"></ion-icon></div> 
                                    <div> 
                                        <p class="font-medium text-gray-900">Completed Reading Fluency Test</p> 
                                        <p class="text-sm text-gray-500">Speed: 88 WPM, Accuracy: 95% • 1 hour ago</p> 
                                    </div> 
                                </div> 
                                <span class="text-sm font-semibold text-green-600">Excellent</span> 
                            </li> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"> 
                                <div class="flex items-center space-x-3"> 
                                    <div class="p-2 rounded-full bg-blue-100 text-blue-600"><ion-icon name="chatbox-ellipses-outline" class="text-xl"></ion-icon></div> 
                                    <div> 
                                        <p class="font-medium text-gray-900">Finished Comprehension Practice</p> 
                                        <p class="text-sm text-gray-500">Score: 8/10 • 2 hours ago</p> 
                                    </div> 
                                </div> 
                                <span class="text-sm font-semibold text-blue-600">Good</span> 
                            </li> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"> 
                                <div class="flex items-center space-x-3"> 
                                    <div class="p-2 rounded-full bg-violet-100 text-violet-600"><ion-icon name="library-outline" class="text-xl"></ion-icon></div> 
                                    <div> 
                                        <p class="font-medium text-gray-900">Vocabulary Quiz</p> 
                                        <p class="text-sm text-gray-500">Score: 9/10 • Yesterday</p> 
                                    </div> 
                                </div> 
                                <span class="text-sm font-semibold text-violet-600">Excellent</span> 
                            </li> 
                        </ul> 
                    </div> 

                    <!-- BOTTOM RIGHT: Time Spent This Week -->
                    <div class="bg-white p-6 rounded-xl shadow-md"> 
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Time Spent This Week</h3> 
                        <div class="space-y-4"> 
                            <div> 
                                <div class="flex justify-between mb-1"> <span class="text-sm font-medium text-gray-700">Reading Practice</span> <span class="text-sm font-medium text-gray-500">2h 45m</span> </div> 
                                <div class="w-full bg-gray-200 rounded-full h-2"> <div class="bg-blue-500 h-2 rounded-full" style="width: 60%"></div> </div> 
                            </div> 
                            <div> 
                                <div class="flex justify-between mb-1"> <span class="text-sm font-medium text-gray-700">Vocabulary Games</span> <span class="text-sm font-medium text-gray-500">1h 15m</span> </div> 
                                <div class="w-full bg-gray-200 rounded-full h-2"> <div class="bg-violet-500 h-2 rounded-full" style="width: 25%"></div> </div> 
                            </div> 
                            <div> 
                                <div class="flex justify-between mb-1"> <span class="text-sm font-medium text-gray-700">Comprehension Tasks</span> <span class="text-sm font-medium text-gray-500">1h 00m</span> </div> 
                                <div class="w-full bg-gray-200 rounded-full h-2"> <div class="bg-amber-500 h-2 rounded-full" style="width: 15%"></div> </div> 
                            </div> 
                        </div> 
                    </div> 
                </div>

                <!-- BOTTOM SECTION: Recommended Actions (Full Width) -->
                <div class="mt-6">
                    <div class="bg-white p-6 rounded-xl shadow-md"> 
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Recommended Actions</h3> 
                        <ul class="space-y-3"> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"> 
                                <div class="flex items-center"> 
                                    <span class="text-xs font-bold text-orange-600 bg-orange-100 px-2 py-1 rounded-full mr-3">MEDIUM</span> 
                                    <div> <p class="font-medium text-gray-900">Practice Complex Sentences</p> <p class="text-sm text-gray-600">Assign reading passages with longer sentences to improve fluency.</p> </div> 
                                </div> 
                                <button onclick="handleFindPassages()" class="bg-accent text-white font-medium px-4 py-2 rounded-lg text-sm hover:bg-accent-dark">Find Passages</button> 
                            </li> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"> 
                                <div class="flex items-center"> 
                                    <span class="text-xs font-bold text-blue-600 bg-blue-100 px-2 py-1 rounded-full mr-3">LOW</span> 
                                    <div> <p class="font-medium text-gray-900">Review Comprehension Strategy</p> <p class="text-sm text-gray-600">Go over strategies for identifying the main idea in texts.</p> </div> 
                                </div> 
                                <button onclick="handleViewTips()" class="bg-accent text-white font-medium px-4 py-2 rounded-lg text-sm hover:bg-accent-dark">View Tips</button> 
                            </li> 
                        </ul> 
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- PAGE 3: INSIGHTS -->
    <div id="page-insights" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                             <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="user-avatar-insights" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                        <span id="user-name-insights" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page Content -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Content with added chart placeholder and recommendations (unchanged from previous) -->
            <div class="px-4 py-6 sm:px-0"> <h1 class="text-3xl font-bold text-gray-900 mb-2">AI-Powered Insights</h1> <p class="text-lg text-gray-600 mb-8">Discover patterns and recommendations based on Akash's learning habits.</p> <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"> <div class="lg:col-span-2 space-y-6"> <div class="bg-white p-6 rounded-xl shadow-md"> <h3 class="text-xl font-semibold text-gray-900 mb-4">Key Insights</h3> <ul class="space-y-4"> <li class="flex items-start space-x-3"> <div class="p-2 rounded-full bg-sky-100 text-sky-600 mt-1"><ion-icon name="trending-up-outline" class="text-xl"></ion-icon></div> <div> <p class="font-medium text-gray-900">Progress Trend: Reading</p> <p class="text-sm text-gray-600">Reading comprehension has improved by 15% this week. He is consistently performing well in this area. Great progress!</p> <button class="text-sm font-semibold text-accent hover:underline mt-1">View Reading Details</button> </div> </li> <li class="flex items-start space-x-3"> <div class="p-2 rounded-full bg-sky-100 text-sky-600 mt-1"><ion-icon name="alarm-outline" class="text-xl"></ion-icon></div> <div> <p class="font-medium text-gray-900">Optimal Study Time</p> <p class="text-sm text-gray-600">Best performance and focus observed between 4-6 PM. Schedule reading practice during this time for better results.</p> <button class="text-sm font-semibold text-accent hover:underline mt-1">Set Study Reminder</button> </div> </li> <li class="flex items-start space-x-3"> <div class="p-2 rounded-full bg-sky-100 text-sky-600 mt-1"><ion-icon name="speedometer-outline" class="text-xl"></ion-icon></div> <div> <p class="font-medium text-gray-900">Pacing Suggestion</p> <p class="text-sm text-gray-600">Akash shows good speed in reading fluency tests. Ensure he also takes time to fully comprehend the text afterwards.</p> <button class="text-sm font-semibold text-accent hover:underline mt-1">Discuss with Teacher</button> </div> </li> <li class="flex items-start space-x-3"> <div class="p-2 rounded-full bg-yellow-100 text-yellow-600 mt-1"><ion-icon name="alert-circle-outline" class="text-xl"></ion-icon></div> <div> <p class="font-medium text-gray-900">Vocabulary Focus</p> <p class="text-sm text-gray-600">While vocabulary is strong overall, introducing more complex synonyms could further enhance writing and comprehension skills.</p> <button class="text-sm font-semibold text-accent hover:underline mt-1">Find Vocabulary Games</button> </div> </li> </ul> </div> <div class="bg-white p-6 rounded-xl shadow-md"> <h3 class="text-xl font-semibold text-gray-900 mb-4">Focus Trend Over Time</h3> <div class="h-64 bg-gray-100 rounded-lg flex items-center justify-center"> <p class="text-gray-500 italic">Line chart showing focus levels over the past month will appear here.</p> </div> </div> </div> <div class="lg:col-span-1 space-y-6"> <div class="bg-white p-6 rounded-xl shadow-md"> <h3 class="text-xl font-semibold text-gray-900 mb-4">Learning Habits</h3> <ul class="space-y-3"> <li class="flex items-center space-x-3"> <div class="p-2 rounded-full bg-green-100 text-green-600"><ion-icon name="checkmark-circle-outline" class="text-xl"></ion-icon></div> <p class="text-sm text-gray-600">Consistent study times</p> </li> <li class="flex items-center space-x-3"> <div class="p-2 rounded-full bg-green-100 text-green-600"><ion-icon name="book-outline" class="text-xl"></ion-icon></div> <p class="text-sm text-gray-600">High engagement in Reading</p> </li> <li class="flex items-center space-x-3"> <div class="p-2 rounded-full bg-green-100 text-green-600"><ion-icon name="timer-outline" class="text-xl"></ion-icon></div> <p class="text-sm text-gray-600">Good focus during 4-6 PM</p> </li> <li class="flex items-center space-x-3"> <div class="p-2 rounded-full bg-yellow-100 text-yellow-600"><ion-icon name="alert-circle-outline" class="text-xl"></ion-icon></div> <p class="text-sm text-gray-600">Slight hesitation on complex words</p> </li> </ul> </div> <div class="bg-white p-6 rounded-xl shadow-md"> <h3 class="text-xl font-semibold text-gray-900 mb-4">AI Recommendations</h3> <ul class="space-y-4"> <li class="flex items-start space-x-3"> <div class="p-2 rounded-full bg-sky-100 text-sky-600 mt-1 flex-shrink-0"><ion-icon name="reader-outline" class="text-xl"></ion-icon></div> <div> <p class="font-medium text-gray-900">Challenging Texts</p> <p class="text-sm text-gray-600">Introduce short stories or articles slightly above Akash's current reading level to encourage vocabulary growth and comprehension practice.</p> </div> </li> <li class="flex items-start space-x-3"> <div class="p-2 rounded-full bg-sky-100 text-sky-600 mt-1 flex-shrink-0"><ion-icon name="timer-outline" class="text-xl"></ion-icon></div> <div> <p class="font-medium text-gray-900">Timed Reading</p> <p class="text-sm text-gray-600">Incorporate short, timed reading exercises (1-2 minutes) followed by quick comprehension checks to improve both speed and focus.</p> </div> </li> </ul> </div> </div> </div> </div>
        </main>
    </div>

    <!-- PAGE 9: AI CONTENT GENERATOR (NEW) -->
    <div id="page-generator" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="user-avatar-generator" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                        <span id="user-name-generator" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page Content -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">AI Content Generator</h1>
                <p class="text-lg text-gray-600 mb-8">Generate custom learning materials based on a topic for Akash.</p>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Generator Controls -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md h-min space-y-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Customize Content</h3>
                        
                        <!-- Content Type Selector -->
                        <div>
                            <label for="content-type-selector" class="block text-sm font-medium text-gray-900 mb-1">Content Type</label>
                            <select id="content-type-selector" name="content-type" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent sm:text-sm">
                                <option>Study Guide</option>
                                <option>Creative Story Prompt</option>
                                <option>Vocabulary Challenge</option>
                            </select>
                        </div>
                        
                        <!-- Topic Prompt Area -->
                        <div>
                            <label for="generator-prompt" class="block text-sm font-medium text-gray-900 mb-1">Topic/Prompt (e.g., "The lifecycle of a butterfly")</label>
                            <textarea id="generator-prompt" rows="4" placeholder="Enter the topic or a detailed request here..." class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-accent focus:border-accent resize-none"></textarea>
                            <p class="text-xs text-gray-500 mt-1">Provide at least 10 characters.</p>
                        </div>

                        <!-- Generate Button -->
                        <button id="generate-content-btn" onclick="handleGenerateContent()" class="w-full bg-accent text-white font-semibold px-5 py-3 rounded-lg shadow-md hover:bg-accent-dark transition duration-200 flex items-center justify-center gap-2">
                            <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> Generate Content
                        </button>
                    </div>

                    <!-- Generated Output -->
                    <div class="lg:col-span-2 space-y-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Generated Output</h3>
                        <div id="generated-content-results" class="bg-gray-50 text-gray-700 hidden">
                            <!-- Content or Loading state injected here -->
                        </div>
                        <div id="initial-message" class="bg-white p-6 rounded-xl shadow-md text-center text-gray-500">
                             <ion-icon name="chatbubble-ellipses-outline" class="text-4xl mb-2 text-accent"></ion-icon>
                             <p class="text-md font-medium">Enter a topic and hit 'Generate' to create custom learning materials for Akash.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PAGE 4: REPORTS -->
    <div id="page-reports" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="user-avatar-reports" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                        <span id="user-name-reports" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page Content -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Content with enhanced recent reports list -->
            <div class="px-4 py-6 sm:px-0"> 
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Download Reports</h1> 
                <p class="text-lg text-gray-600 mb-8">Generate new reports or download past reports for Akash.</p> 
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> 
                    <div class="bg-white p-6 rounded-xl shadow-md"> 
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Generate New Report</h3> 
                        <div class="space-y-4"> 
                            <div> 
                                <label for="report-type" class="block text-sm font-medium text-gray-900">Report Type</label> 
                                <select id="report-type" name="report-type" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent sm:text-sm"> 
                                    <option>Weekly Progress Summary</option> 
                                    <option>Monthly Deep Dive</option> 
                                    <option>Reading & Comprehension Report</option> 
                                </select> 
                            </div> 
                            <div> 
                                <label for="report-range" class="block text-sm font-medium text-gray-900">Date Range</label> 
                                <select id="report-range" name="report-range" class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-accent focus:border-accent sm:text-sm"> 
                                    <option>Last 7 Days</option> 
                                    <option>Last 30 Days</option> 
                                    <option>This Quarter</option> 
                                </select> 
                            </div> 
                            <button onclick="handleGenerateReport()" class="w-full bg-accent text-white font-semibold px-5 py-3 rounded-lg shadow-md hover:bg-accent-dark transition duration-200 flex items-center justify-center gap-2"> 
                                <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Generate & View Report 
                            </button> 
                        </div> 
                    </div> 
                    <div class="bg-white p-6 rounded-xl shadow-md"> 
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Recent Reports (Simulated)</h3> 
                        <ul class="space-y-3"> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-150"> 
                                <div class="flex items-center space-x-3"> 
                                    <ion-icon name="document-outline" class="text-xl text-gray-500"></ion-icon> 
                                    <div> 
                                        <p class="font-medium text-gray-900">Weekly Summary</p> 
                                        <p class="text-sm text-gray-600">Oct 19, 2025 - Oct 25, 2025</p> 
                                    </div> 
                                </div> 
                                <button onclick="handleReportDownload('Weekly Summary', 'Oct 19-25')" class="text-accent hover:text-accent-dark" title="Download"> 
                                    <ion-icon name="download-outline" class="text-2xl"></ion-icon> 
                                </button> 
                            </li> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-150"> 
                                <div class="flex items-center space-x-3"> 
                                    <ion-icon name="reader-outline" class="text-xl text-gray-500"></ion-icon> 
                                    <div> 
                                        <p class="font-medium text-gray-900">Reading & Comprehension Report</p> 
                                        <p class="text-sm text-gray-600">Sep 1, 2025 - Sep 30, 2025</p> 
                                    </div> 
                                </div> 
                                <button onclick="handleReportDownload('Reading & Comprehension Report', 'Sep 1-30')" class="text-accent hover:text-accent-dark" title="Download"> 
                                    <ion-icon name="download-outline" class="text-2xl"></ion-icon> 
                                </button> 
                            </li> 
                            <li class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-150"> 
                                <div class="flex items-center space-x-3"> 
                                    <ion-icon name="calendar-outline" class="text-xl text-gray-500"></ion-icon> 
                                    <div> 
                                        <p class="font-medium text-gray-900">Monthly Deep Dive</p> 
                                        <p class="text-sm text-gray-600">September 2025</p> 
                                    </div> 
                                </div> 
                                <button onclick="handleReportDownload('Monthly Deep Dive', 'September')" class="text-accent hover:text-accent-dark" title="Download"> 
                                    <ion-icon name="download-outline" class="text-2xl"></ion-icon> 
                                </button> 
                            </li> 
                        </ul> 
                        <p class="text-xs text-red-500 mt-4">Note: Only "Weekly Summary" download is authorized in this demo.</p>
                    </div> 
                </div> 
            </div>
        </main>
    </div>

    <!-- PAGE 5: SETTINGS -->
    <div id="page-settings" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="user-avatar-settings" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                        <span id="user-name-settings" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page Content: Added Theme Toggle -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">Settings</h1>
                <div class="bg-white p-6 rounded-xl shadow-md max-w-lg space-y-6"> <!-- Added space-y-6 -->
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-2">Appearance</h2>
                        <div class="flex justify-between items-center">
                            <label for="theme-toggle" class="text-sm font-medium text-gray-700">Dark Mode</label>
                            <div class="theme-switch-wrapper">
                                <label class="theme-switch">
                                    <input type="checkbox" id="theme-toggle">
                                    <span class="slider">
                                        <!-- Sun icon for light mode -->
                                        <ion-icon name="sunny-outline" class="sun"></ion-icon> 
                                        <!-- Moon icon for dark mode -->
                                        <ion-icon name="moon-outline" class="moon"></ion-icon> 
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="border-t pt-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Account</h2>
                        <p class="text-gray-600 mb-6">Manage your account settings and preferences.</p>
                        <button onclick="document.getElementById('logout-modal').classList.remove('hidden')" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-5 py-3 rounded-lg shadow-md transition duration-200 flex items-center gap-2"> <ion-icon name="log-out" class="text-xl"></ion-icon> Logout </button>
                        <p class="mt-8 text-gray-500 text-sm"> Other settings like notification preferences and child management will appear here. </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PAGE 6: ASSESSMENT HUB -->
    <div id="page-assessment" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="user-avatar-assessment" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                        <span id="user-name-assessment" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page Content (unchanged) -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"> <div class="px-4 py-6 sm:px-0"> <h1 class="text-3xl font-bold text-gray-900 mb-2">Start a New Assessment</h1> <p class="text-lg text-gray-600 mb-8">Select a skill area to begin a short assessment for Akash.</p> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <div class="bg-white p-6 rounded-xl shadow-md flex flex-col justify-between"> <div> <div class="p-3 rounded-full bg-blue-100 text-blue-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="mic-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">Reading Fluency</h3> <p class="text-gray-600 text-sm mb-4">Assesses reading speed and accuracy by recording Akash reading aloud. (Approx. 5 mins)</p> </div> <button onclick="navigateTo('page-assessment-reading')" class="w-full bg-accent text-white font-semibold px-5 py-3 rounded-lg shadow-md hover:bg-accent-dark transition duration-200 flex items-center justify-center gap-2"> Start Assessment </button> </div> <div class="bg-white p-6 rounded-xl shadow-md flex flex-col justify-between"> <div> <div class="p-3 rounded-full bg-violet-100 text-violet-600 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="document-text-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-900 mb-1">Comprehension Skills</h3> <p class="text-gray-600 text-sm mb-4">Checks understanding of a provided text passage. Requires file upload. (Approx. 10 mins)</p> </div> <button onclick="navigateTo('page-assessment-comprehension')" class="w-full bg-accent text-white font-semibold px-5 py-3 rounded-lg shadow-md hover:bg-accent-dark transition duration-200 flex items-center justify-center gap-2"> Start Assessment </button> </div> <div class="bg-gray-100 p-6 rounded-xl border border-dashed border-gray-300 flex flex-col justify-center items-center text-center md:col-span-2"> <div class="p-3 rounded-full bg-gray-200 text-gray-500 w-12 h-12 flex items-center justify-center mb-3"><ion-icon name="add-outline" class="text-3xl"></ion-icon></div> <h3 class="text-lg font-semibold text-gray-600 mb-1">More Soon</h3> <p class="text-gray-500 text-sm">Additional assessment types will be available here.</p> </div> </div> </div> </main>
    </div>

    <!-- PAGE 7: READING ASSESSMENT PAGE -->
    <div id="page-assessment-reading" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="user-avatar-assessment-reading" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                        <span id="user-name-assessment-reading" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page Content with Previous Results section -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <button onclick="navigateTo('page-assessment')" class="text-sm text-gray-600 hover:text-accent mb-4 inline-flex items-center gap-1"> <ion-icon name="arrow-back-outline"></ion-icon> Back to Assessments </button>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Reading Fluency Assessment</h1>
                <p class="text-lg text-gray-600 mb-8">Record Akash reading the passage below.</p>
                <div class="bg-white p-6 rounded-xl shadow-md max-w-2xl mx-auto space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-3">Passage to Read:</h3>
                        <div class="bg-gray-50 p-4 rounded-lg border mb-4"> <p id="reading-passage" class="text-gray-800 text-lg leading-relaxed"></p> </div>
                        <div class="flex items-center justify-center space-x-4 mb-4"> <span id="recording-status" class="text-sm font-medium text-gray-500 flex items-center gap-2"></span> </div>
                        <div class="flex justify-center space-x-3 mb-6"> <button id="start-record-btn" onclick="startRecording()" class="bg-green-500 hover:bg-green-600 text-white font-semibold px-5 py-3 rounded-lg shadow-md transition duration-200 flex items-center gap-2"> <ion-icon name="mic-circle-outline" class="text-xl"></ion-icon> Start </button> <button id="pause-record-btn" onclick="pauseRecording()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-5 py-3 rounded-lg shadow-md transition duration-200 flex items-center gap-2 hidden"> <ion-icon name="pause-outline" class="text-xl"></ion-icon> Pause </button> <button id="resume-record-btn" onclick="resumeRecording()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-3 rounded-lg shadow-md transition duration-200 flex items-center gap-2 hidden"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Resume </button> <button id="stop-record-btn" onclick="stopRecording()" class="bg-red-500 hover:bg-red-600 text-white font-semibold px-5 py-3 rounded-lg shadow-md transition duration-200 flex items-center gap-2 hidden"> <ion-icon name="stop-circle-outline" class="text-xl"></ion-icon> Stop </button> </div>
                        <div id="reading-assessment-results" class="mt-4 p-4 bg-gray-100 rounded-lg text-sm text-gray-600 hidden"> <p class="font-medium text-gray-800 mb-1">Assessment Results:</p> <p>Placeholder...</p> </div>
                    </div>
                    <!-- Previous Results Section -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-3 border-t pt-6">Previous Results</h3>
                        <ul class="space-y-3">
                            <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"> <div> <p class="font-medium text-gray-800 text-sm">Oct 24, 2025</p> <p class="text-xs text-gray-600">Speed: 85 WPM, Accuracy: 94%</p> </div> <span class="text-sm font-semibold text-green-600">Good</span> </li>
                            <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"> <div> <p class="font-medium text-gray-800 text-sm">Oct 17, 2025</p> <p class="text-xs text-gray-600">Speed: 82 WPM, Accuracy: 92%</p> </div> <span class="text-sm font-semibold text-yellow-600">Fair</span> </li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PAGE 8: COMPREHENSION ASSESSMENT PAGE -->
    <div id="page-assessment-comprehension" class="page">
        <!-- Header updated -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="logo-container">
                            <!-- Logo for SoundSlate: Sleek 'S' in a rounded box -->
                            <div class="w-6 h-6 rounded-md flex items-center justify-center font-black text-white" style="background-color: var(--accent); font-size: 1.25rem; line-height: 1;">S</div>
                            <div class="soundslate-logo-text">SOUNDSLATE</div>
                        </div>
                        <nav class="hidden md:flex space-x-2">
                            <a href="#" onclick="navigateTo('page-home')" data-page="page-home" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="home-outline" class="text-xl"></ion-icon> Home </a>
                            <a href="#" onclick="navigateTo('page-progress')" data-page="page-progress" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="stats-chart-outline" class="text-xl"></ion-icon> Progress </a>
                            <a href="#" onclick="navigateTo('page-insights')" data-page="page-insights" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="bulb-outline" class="text-xl"></ion-icon> Insights </a>
                            <a href="#" onclick="navigateTo('page-generator')" data-page="page-generator" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="sparkles-outline" class="text-xl"></ion-icon> AI Content </a>
                            <a href="#" onclick="navigateTo('page-reports')" data-page="page-reports" class="nav-link inactive flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="document-text-outline" class="text-xl"></ion-icon> Reports </a>
                            <a href="#" onclick="navigateTo('page-assessment')" data-page="page-assessment" class="nav-link active flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium"> <ion-icon name="play-outline" class="text-xl"></ion-icon> Assessment </a>
                        </nav>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div id="user-avatar-assessment-comp" class="w-8 h-8 rounded-full bg-starry-night text-white flex items-center justify-center font-semibold bg-cover bg-center">A</div>
                        <span id="user-name-assessment-comp" class="hidden md:block text-sm font-medium text-gray-700">Hi, Abhishek!</span>
                        <div class="flex items-center space-x-1 relative">
                            <!-- Notification Button - opens modal via JS -->
                            <button onclick="toggleNotificationDropdown(event)" class="notification-badge-container text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Notifications"> <ion-icon name="notifications-outline" class="text-2xl"></ion-icon> <span class="notification-badge"></span> </button>
                            <!-- NOTE: Notification Dropdown HTML is removed from here -->
                            <button onclick="navigateTo('page-settings')" class="text-gray-500 hover:text-white hover:bg-accent p-2 rounded-full transition-all duration-200" title="Settings"> <ion-icon name="settings-outline" class="text-2xl"></ion-icon> </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page Content with Previous Results section -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <button onclick="navigateTo('page-assessment')" class="text-sm text-gray-600 hover:text-accent mb-4 inline-flex items-center gap-1"> <ion-icon name="arrow-back-outline"></ion-icon> Back to Assessments </button>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Comprehension Skills Assessment</h1>
                <p class="text-lg text-gray-600 mb-8">Provide a text passage for Akash to read, then start the assessment.</p>
                
                <div class="bg-white p-6 rounded-xl shadow-md max-w-2xl mx-auto space-y-6">
                    
                    <!-- 1. GIVEN PASSAGE (Read-only) -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Passage for Comprehension:</h3>
                        <div class="bg-gray-50 p-4 rounded-lg border border-indigo-300/50">
                            <p id="comprehension-given-passage" class="text-gray-800 text-base leading-relaxed italic">Loading passage...</p>
                            <p class="text-xs text-gray-600 mt-2 font-medium">Read this text and use the space below to provide your written response or upload a file.</p>
                        </div>
                    </div>

                    <!-- 2. STUDENT INPUT MODE TOGGLE -->
                    <div class="flex justify-center space-x-3 p-1 rounded-lg bg-gray-100">
                        <button id="mode-upload-btn" onclick="setComprehensionMode('upload')" class="toggle-button active flex-1 px-4 py-2 rounded-md text-sm font-medium transition duration-150 flex items-center justify-center gap-2">
                             <ion-icon name="cloud-upload-outline"></ion-icon> Upload File (Response)
                        </button>
                        <button id="mode-write-btn" onclick="setComprehensionMode('write')" class="toggle-button inactive flex-1 px-4 py-2 rounded-md text-sm font-medium transition duration-150 flex items-center justify-center gap-2">
                            <ion-icon name="pencil-outline"></ion-icon> Write Response
                        </button>
                    </div>

                    <!-- 3. INPUT CONTAINER (Dynamically Populated) -->
                    <div id="comprehension-input-area">
                        <!-- Initial Content (Upload) is set here by setupComprehensionAssessmentPage() -->
                    </div>

                    <button id="start-comprehension-btn" onclick="startComprehensionAssessment()" disabled class="w-full bg-gray-400 text-white font-semibold px-5 py-3 rounded-lg shadow-md cursor-not-allowed flex items-center justify-center gap-2 transition duration-200"> <ion-icon name="play-circle-outline" class="text-xl"></ion-icon> Submit Response for Assessment </button>
                    
                    <div id="comprehension-assessment-results" class="mt-4 p-4 bg-gray-100 rounded-lg text-sm text-gray-600 hidden"> <p class="font-medium text-gray-800 mb-1">Assessment Results:</p> <p>Placeholder...</p> </div>
                    
                    <!-- Previous Results Section -->
                    <div>
                        <h3 class="lg:text-lg font-semibold text-gray-900 mb-3 border-t pt-6">Previous Results</h3>
                        <ul class="space-y-3">
                            <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"> <div> <p class="font-medium text-gray-800 text-sm">Oct 23, 2025 (Story: The Fox)</p> <p class="text-xs text-gray-600">Score: 8/10, Vocabulary: 9/10</p> </div> <span class="text-sm font-semibold text-blue-600">Good</span> </li>
                            <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"> <div> <p class="font-medium text-gray-800 text-sm">Oct 15, 2025 (Article: Planets)</p> <p class="text-xs text-gray-600">Score: 7/10, Vocabulary: 8/10</p> </div> <span class="text-sm font-semibold text-yellow-600">Fair</span> </li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>


    <!-- Common Modals and FABs -->
    <div id="fab-container" class="fixed bottom-6 right-6 space-y-3 z-40 hidden"> <button onclick="showToast('Connecting to teacher... (Demo)', 'info')" class="bg-starry-night text-white w-14 h-14 rounded-full shadow-md flex items-center justify-center transition-all duration-200 hover:scale-110 opacity-90 hover:opacity-100 hover:shadow-xl bg-cover bg-center" title="Chat with Teacher"> <ion-icon name="people" class="text-3xl"></ion-icon> </button> <button onclick="handleGenerateReport()" class="bg-starry-night text-white w-14 h-14 rounded-full shadow-md flex items-center justify-center transition-all duration-200 hover:scale-110 opacity-90 hover:opacity-100 hover:shadow-xl bg-cover bg-center" title="Generate Report"> <ion-icon name="document-text" class="text-3xl"></ion-icon> </button> <button onclick="toggleChat()" class="bg-starry-night text-white w-14 h-14 rounded-full shadow-md flex items-center justify-center transition-all duration-200 hover:scale-110 opacity-90 hover:opacity-100 hover:shadow-xl bg-cover bg-center" title="AI Assistant"> <ion-icon name="chatbubbles" class="text-3xl"></ion-icon> </button> </div>
    <div id="chat-widget" class="fixed bottom-24 right-6 w-80 h-96 bg-white rounded-2xl shadow-xl z-40 hidden flex-col overflow-hidden border"> <div class="p-4 bg-starry-gradient text-white flex justify-between items-center"> <h3 class="font-semibold text-lg">Boo - AI Assistant</h3> <button onclick="toggleChat()" class="text-white/80 hover:text-white"> <ion-icon name="close-outline" class="text-2xl"></ion-icon> </button> </div> <div id="chat-messages" class="flex-1 p-4 space-y-4 overflow-y-auto"> <div class="flex"><div class="chat-bubble chat-bubble-ai"> Hi! I'm Boo. How can I help you understand Akash's reading and comprehension progress today? </div></div> </div> <div class="p-4 border-t bg-white"> <form id="chat-form" class="flex items-center gap-2"> <input id="chat-input" type="text" placeholder="Ask about progress..." class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-accent"> <button type="submit" class="bg-accent text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-accent-dark"> <ion-icon name="arrow-up-outline" class="text-xl"></ion-icon> </button> </form> </div> </div>
    
    <!-- All Notifications Modal -->
    <div id="notification-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-xl font-semibold text-gray-900">All Notifications</h3>
                <button onclick="document.getElementById('notification-modal').classList.add('hidden')" class="text-gray-500 hover:text-gray-800">
                    <ion-icon name="close-outline" class="text-3xl"></ion-icon>
                </button>
            </div>
            <div class="overflow-y-auto space-y-3">
                <!-- Full Notification List Content -->
                <div class="p-3 bg-gray-50 rounded-lg flex items-start space-x-3 hover:bg-gray-100 cursor-pointer">
                    <ion-icon name="trending-up-outline" class="text-xl text-green-600 flex-shrink-0 mt-1"></ion-icon>
                    <div>
                        <p class="font-medium text-gray-900">Reading speed increased!</p>
                        <p class="text-xs text-gray-600">Akash is now reading at 88 WPM. 2h ago</p>
                    </div>
                </div>
                <div onclick="navigateTo('page-reports'); document.getElementById('notification-modal').classList.add('hidden');" class="p-3 bg-gray-50 rounded-lg flex items-start space-x-3 hover:bg-gray-100 cursor-pointer">
                    <ion-icon name="document-text-outline" class="text-xl text-blue-600 flex-shrink-0 mt-1"></ion-icon>
                    <div>
                        <p class="font-medium text-gray-900">New weekly report available.</p>
                        <p class="text-xs text-gray-600">Summary for Oct 19-25 is ready. Yesterday</p>
                    </div>
                </div>
                <div onclick="navigateTo('page-insights'); document.getElementById('notification-modal').classList.add('hidden');" class="p-3 bg-gray-50 rounded-lg flex items-start space-x-3 hover:bg-gray-100 cursor-pointer">
                    <ion-icon name="bulb-outline" class="text-xl text-yellow-600 flex-shrink-0 mt-1"></ion-icon>
                    <div>
                        <p class="font-medium text-gray-900">Focus Area: Complex Words</p>
                        <p class="text-xs text-gray-600">AI suggests practice. 3d ago</p>
                    </div>
                </div>
                <!-- Duplicated content for scrolling effect -->
                <div class="p-3 bg-gray-50 rounded-lg flex items-start space-x-3 text-gray-500">
                    <ion-icon name="alarm-outline" class="text-xl text-gray-400 flex-shrink-0 mt-1"></ion-icon>
                    <div><p class="font-medium text-gray-900">Missed Practice Alert</p><p class="text-xs text-gray-600">Akash missed his optimal reading slot today. 4d ago</p></div>
                </div>
                <div class="p-3 bg-gray-50 rounded-lg flex items-start space-x-3 text-gray-500">
                    <ion-icon name="bookmark-outline" class="text-xl text-gray-400 flex-shrink-0 mt-1"></ion-icon>
                    <div><p class="font-medium text-gray-900">New Vocabulary Set</p><p class="text-xs text-gray-600">Set 'Ocean Life' is ready for review. 5d ago</p></div>
                </div>
                <div class="p-3 bg-gray-50 rounded-lg flex items-start space-x-3 text-gray-500">
                    <ion-icon name="trending-down-outline" class="text-xl text-gray-400 flex-shrink-0 mt-1"></ion-icon>
                    <div><p class="font-medium text-gray-900">Fluency Dip</p><p class="text-xs text-gray-600">A slight dip in fluency observed on Tuesday. 6d ago</p></div>
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6"> 
                <button onclick="document.getElementById('notification-modal').classList.add('hidden')" class="px-5 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"> Close </button>
            </div>
        </div>
    </div>

    <!-- Modals (Logout, Report) -->
    <div id="logout-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden"> <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm"> <h3 class="text-lg font-medium text-gray-900 mb-2">Are you sure?</h3> <p class="text-sm text-gray-600 mb-4">Are you sure you want to log out?</p> <div class="flex justify-end space-x-3"> <button onclick="document.getElementById('logout-modal').classList.add('hidden')" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"> Cancel </button> <button onclick="handleLogout()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"> OK </button> </div> </div> </div>
    
    <!-- Report Modal (Used for Report and AI Passages) -->
    <div id="report-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden"> 
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col"> 
            <div class="flex justify-between items-center mb-4"> 
                <h3 id="report-modal-title" class="text-xl font-semibold text-gray-900">AI-Generated Progress Report</h3> 
                <button onclick="document.getElementById('report-modal').classList.add('hidden')" class="text-gray-500 hover:text-gray-800"> <ion-icon name="close-outline" class="text-3xl"></ion-icon> </button> 
            </div> 
            <div class="overflow-y-auto"> 
                <div id="report-content" class="text-sm text-gray-700 bg-gray-50 p-4 rounded-lg border"></div> 
            </div> 
            <div class="flex justify-end space-x-3 mt-6"> 
                <button onclick="document.getElementById('report-modal').classList.add('hidden')" class="px-5 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark"> Done </button> 
            </div> 
        </div> 
    </div>

    <!-- New Tips Modal -->
    <div id="recommended-tips-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-xl max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-xl font-semibold text-gray-900">Comprehension Improvement Tips</h3>
                <button onclick="document.getElementById('recommended-tips-modal').classList.add('hidden')" class="text-gray-500 hover:text-gray-800">
                    <ion-icon name="close-outline" class="text-3xl"></ion-icon>
                </button>
            </div>
            <div class="overflow-y-auto">
                <div id="tips-modal-content" class="text-sm text-gray-700 space-y-4">
                    <!-- Content injected by JS -->
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6"> 
                <button onclick="document.getElementById('recommended-tips-modal').classList.add('hidden')" class="px-5 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark"> Got it! </button>
            </div>
        </div>
    </div>


    <div id="toast-notification" class="toast-notification"> <p id="toast-message">Default Toast Message</p> </div>

    <script>
        // --- GLOBAL VARIABLES ---
        let currentUserName = "Abhishek";
        let subjectChart = null;
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob = null;
        let selectedComprehensionFile = null;
        let currentComprehensionMode = 'upload'; // 'upload' or 'write'
        let chatHistory = []; // Moved chatHistory outside DOMContentLoaded
        
        const MIN_COMPREHENSION_WORDS = 50;

        // Sentences for Reading Fluency Assessment (Page 7)
        const readingPassages = [ 
            "The sun dipped below the horizon, painting the sky in shades of orange and purple.", 
            "A gentle breeze rustled the leaves in the tall oak trees.", 
            "Butterflies with vibrant wings danced among the colorful wildflowers.", 
            "The old lighthouse stood watch over the rocky coastline.", 
            "Children laughed as they built sandcastles on the beach.", 
            "A curious squirrel scampered up a tree, chattering loudly.", 
            "Stars began to appear one by one in the darkening twilight sky.", 
            "The wise owl hooted softly from its perch high above.", 
            "Waves crashed against the shore, creating a soothing rhythm.", 
            "A small boat sailed peacefully across the calm blue water." 
        ];

        // Sample passages for Comprehension Assessment
        const comprehensionPassages = [
            "A small town called Oakhaven was famous for its ancient clock tower. Every noon, it chimed twelve times, a sound that echoed through the surrounding valley. Recently, the clock began skipping chimes, sometimes ringing eleven, sometimes thirteen. The town elder believed this was a sign of a coming change, while the young clockmaker insisted it was merely a faulty spring that needed careful replacement. This mysterious development sparked significant speculation among the townspeople.",
            "The planet Xylos orbits a twin-star system, meaning it never truly experiences night. The inhabitants, known as Sylvans, have developed incredible bioluminescent abilities to cope with the perpetual light. They use patterns of light emission as their primary form of communication, a silent, colorful language of flashes and fades. This unique form of existence has dictated their entire social structure and architectural development over millennia.",
            "Professor Anya Sharma was a botanist who discovered an entirely new species of mushroom in the Amazon rainforest. This mushroom had a peculiar characteristic: it glowed intensely when exposed to low-frequency sound waves. Anya realized the potential for this discovery, especially for deep-sea exploration where light is scarce. She immediately began preparing a detailed documentation of her findings, knowing its publication would dramatically alter the scientific establishment.",
            "The annual Great Balloon Race took place every June. Competitors from around the world gathered in the central meadow, preparing their massive, colorful airships. This year's favorite, Captain Elara, checked her ropes with intense concentration. Her primary competitor, the notoriously arrogant Lord Vex, watched her from his magnificent, custom-built balloon, determined to sabotage her success through calculated maneuvering. The immense crowd waited in anticipation for the starting cannon to fire.",
            "Eliza, the chief archaeologist, discovered an extraordinary artifact deep within the Egyptian tomb. It was a shimmering, three-dimensional map displaying constellations that scientists believed were impossible to observe from Earth. She felt immense responsibility for the discovery's preservation. Despite immense pressure from rival institutions, she maintained her meticulous documentation, determined to complete the deciphering without interruption. Her meticulous nature proved essential to understanding the complex astronomical configuration.",
        ];

        const comprehensionTips = `
            <h4 class="font-bold text-gray-900">1. Focus on the Main Idea:</h4>
            <p>Encourage Akash to pause after every paragraph or section and verbally summarize the main point. If he can't, re-read that section together to reinforce understanding.</p>

            <h4 class="font-bold text-gray-900">2. Ask the 'W' Questions:</h4>
            <p>Before, during, and after reading, ask: **Who** is the story about? **What** happened? **Where** did it take place? **Why** did the character do that? **When** did it happen? This ensures comprehension of key details.</p>

            <h4 class="font-bold text-gray-900">3. Visualize the Text:</h4>
            <p>Suggest he draw a quick sketch or picture in his mind of what he is reading. This helps turn abstract words into concrete images, strengthening memory and overall understanding.</p>

            <h4 class="font-bold text-gray-900">4. Contextual Clues:</h4>
            <p>If he encounters a hard word, remind him to look at the words around it to guess the meaning before asking for help. This builds independence and vocabulary skills.</p>
        `;


        // --- GEMINI API Config (unchanged) ---
        const CHAT_SYSTEM_PROMPT = `You are Boo, a friendly and encouraging AI assistant for the SoundSlate platform, designed to help parents understand their child's reading and comprehension progress.
- Your goal is to provide clear, actionable insights in a supportive and conversational tone.
- Keep responses concise (2-4 sentences).
- Always address the parent by their name (e.g., "Hi Abhishek!"). The parent's name is ${currentUserName}.
- When asked about data, refer to the "dashboard" or "progress page."
- If asked for recommendations, provide one simple, actionable tip (e.g., "It looks like Akash is doing great with speed! Maybe try asking him to summarize the story afterwards to boost comprehension?").
- Do not make up specific data points not provided in the context. Speak generally about progress.
- Be positive and highlight strengths before suggesting areas for improvement.
- The child's name is Akash.`;

        const REPORT_PROMPT = `Please act as a supportive AI learning assistant for a parent named ${currentUserName}.
The child's name is Akash.
You are generating a progress report from the "SoundSlate" platform.
The user will provide a report type (e.g., "Weekly Progress") and a date range.
Based on the following (simulated) data:
- **Fluency:** 85 WPM (Words Per Minute), which is a +10 WPM improvement this week.
- **Accuracy:** 95% (Excellent).
- **Comprehension:** 80% (Good, +5% improvement).
- **Vocabulary:** 90% (Excellent, 15 new words learned).
- **Time Spent:** 2.5h on Reading, 1.15h on Vocabulary, 1h on Comprehension.
- **Key Insight:** Akash performs best between 4-6 PM.
- **Struggle Area:** Slight hesitation on complex, multi-syllable words (e.g., "establishment," "curiosity").

Generate a concise, encouraging, and easy-to-read report in Markdown format.
- Start with a clear title (e.g., "### Akash's Weekly Progress Report").
- Use bullet points.
- Highlight strengths first.
- Provide one or two actionable recommendations based on the struggle area.
- Keep it positive and supportive.`;

        const PASSAGE_PROMPT = `Generate a creative, short story passage, approximately 200 words long, suitable for a 4th-grade student working on reading fluency and comprehension. The passage should focus on describing a vivid scene and naturally incorporate at least five complex, multi-syllable words (e.g., 'imagination', 'enthusiastically', 'consequence', 'establishment', 'determination'). Format the output as plain text suitable for direct reading.`;
        
        // NEW PROMPT FOR CONTENT GENERATOR PAGE
        const CONTENT_GENERATOR_PROMPT = `You are a helpful and creative educational content generator for the SoundSlate platform. The user will provide a prompt and a content type (e.g., 'Study Guide', 'Creative Story Prompt'). Your task is to generate the requested content based on the user's input and the selected type, suitable for a 4th-grade student.

- If the type is 'Study Guide': Generate a short guide (max 150 words) with 3-4 key facts and 2 simple comprehension questions based on the user's topic. Format as Markdown lists and headers.
- If the type is 'Creative Story Prompt': Generate a vivid, exciting, and short (max 100 words) story starter to inspire a child to write. Focus on tone, setting, and an interesting conflict.
- If the type is 'Vocabulary Challenge': Provide 5 challenging words related to the topic, along with their simple definitions and one example sentence for each. Use Markdown for clarity.

Format the output cleanly using Markdown.`;


        // --- SKILL DATA ARRAY ---
        const skillData = [
            { name: "Accuracy", percentage: 95, color: "bg-green-500", detail: "Target: 98%", status: "Excellent", statusColor: "text-green-700" },
            { name: "Vocabulary", percentage: 90, color: "bg-violet-500", detail: "Grade Level: 4 / Learned 15 new words", status: "Excellent", statusColor: "text-violet-700" },
            { name: "Reading Speed", percentage: 75, color: "bg-blue-500", detail: "Target: 100 WPM / Current: 85 WPM (+10 WPM this week)", status: "Improving", statusColor: "text-blue-700" },
            { name: "Comprehension", percentage: 80, color: "bg-amber-500", detail: "Target: 85% / Current: 80% (+5% this week)", status: "Good", statusColor: "text-amber-700" }
        ];

        // --- GLOBAL HELPER FUNCTIONS ---
        // Functions are defined globally to fix ReferenceErrors on initial load.

        function navigateTo(pageId) {
            // Close all modals (including notification modal) on navigation
            document.getElementById('notification-modal').classList.add('hidden');
            document.getElementById('chat-widget').classList.add('hidden');
            document.getElementById('report-modal').classList.add('hidden'); // Close report/passage modal
            document.getElementById('recommended-tips-modal').classList.add('hidden'); // Close tips modal
            
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) targetPage.classList.add('active');
            else { console.error("Target page not found:", pageId); return; }

            const fabContainer = document.getElementById('fab-container');
            if (pageId === 'page-progress') {
                fabContainer.classList.remove('hidden');
                fabContainer.classList.add('flex', 'flex-col');
                // Only render chart if it's visible (prevents errors if page loaded hidden)
                if (targetPage.offsetParent !== null) {
                    renderSubjectChart();
                    renderSkillProgress(); // Render the skill progress bars
                }
            } else {
                fabContainer.classList.add('hidden');
                fabContainer.classList.remove('flex', 'flex-col');
            }

            // Update nav links
            document.querySelectorAll('header .nav-link').forEach(link => {
                const linkPage = link.getAttribute('data-page');
                link.classList.remove('active', 'bg-starry-night', 'text-white', 'shadow-md');
                link.classList.add('inactive'); // Simplified default state
                if ((pageId === 'page-assessment-reading' || pageId === 'page-assessment-comprehension') && linkPage === 'page-assessment') {
                    link.classList.remove('inactive');
                    link.classList.add('active', 'bg-starry-night', 'text-white', 'shadow-md');
                } else if (linkPage === pageId) {
                    link.classList.remove('inactive');
                    link.classList.add('active', 'bg-starry-night', 'text-white', 'shadow-md');
                }
            });

            if (pageId === 'page-settings') { // Special case for settings
                document.querySelectorAll('header .nav-link').forEach(link => {
                    link.classList.remove('active', 'bg-starry-night', 'text-white', 'shadow-md');
                    link.classList.add('inactive');
                });
            }

            // Update user name/avatar in the *active* page's header
            try {
                const activeHeader = targetPage.querySelector('header');
                if (activeHeader) {
                    activeHeader.querySelector('[id^="user-name-"]').textContent = `Hi, ${currentUserName}!`;
                    activeHeader.querySelector('[id^="user-avatar-"]').textContent = currentUserName.charAt(0).toUpperCase();
                }
            } catch (e) { console.warn("Could not set user name for active page", e); }

            // Setup assessment pages if navigating to them
            if (pageId === 'page-assessment-reading') setupReadingAssessmentPage();
            else if (pageId === 'page-assessment-comprehension') setupComprehensionAssessmentPage();
            else if (pageId === 'page-generator') {
                // Ensure generator input is always active on page load
                document.getElementById('generated-content-results')?.classList.add('hidden');
                document.getElementById('initial-message')?.classList.remove('hidden');
            }
        }

        /**
         * Renders and sorts the skill progress bars based on percentage.
         */
        function renderSkillProgress() {
            const container = document.getElementById('skill-progress-bars');
            if (!container) return;

            // 1. Sort the data array by percentage (descending)
            const sortedData = [...skillData].sort((a, b) => b.percentage - a.percentage);

            // 2. Generate the HTML based on sorted data
            let html = sortedData.map(skill => {
                let detailLeft = skill.detail.includes('/') ? skill.detail.split('/')[0].trim() : skill.detail;
                let detailRight = skill.detail.includes('/') ? skill.detail.split('/')[1].trim() : `Current: ${skill.percentage}%`;
                
                // Overriding text for Comprehension and Reading Speed to match the screenshot better
                if (skill.name === "Comprehension") {
                    detailRight = `Current: 80% (+5% this week)`;
                    detailLeft = `Target: 85%`;
                } else if (skill.name === "Reading Speed") {
                    detailRight = `Current: 85 WPM (+10 WPM this week)`;
                    detailLeft = `Target: 100 WPM`;
                } else if (skill.name === "Accuracy") {
                    detailRight = `Current: 95%`;
                    detailLeft = `Target: 98%`;
                } else if (skill.name === "Vocabulary") {
                     detailRight = `Learned 15 new words`;
                    detailLeft = `Grade Level: 4`;
                }

                return `
                    <div> 
                        <div class="flex justify-between items-center mb-1"> 
                            <span class="text-base font-medium ${skill.statusColor}">${skill.name}</span> 
                            <span class="text-sm font-medium ${skill.statusColor}">${skill.status}</span> 
                        </div> 
                        <div class="w-full bg-gray-200 rounded-full h-2.5"> 
                            <div class="${skill.color} h-2.5 rounded-full" style="width: ${skill.percentage}%"></div> 
                        </div> 
                        <div class="flex justify-between items-center mt-1"> 
                            <span class="text-xs text-gray-500">${detailLeft}</span> 
                            <span class="text-xs text-gray-500">${detailRight}</span> 
                        </div> 
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        function renderSubjectChart() {
            const chartCanvas = document.getElementById('subjectChart');
            if (!chartCanvas) return;
            const ctx = chartCanvas.getContext('2d');
            const primaryTextColor = getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim();
            const gridColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-grid-color').trim();
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();

            const chartData = {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Minutes Practiced',
                    data: [35, 45, 60, 20, 55, 10, 45], // Simulated daily practice minutes
                    backgroundColor: accentColor, 
                    borderColor: accentColor,
                    borderWidth: 1,
                    borderRadius: 4,
                    barPercentage: 0.8,
                    categoryPercentage: 0.8,
                }]
            };

            if (subjectChart) subjectChart.destroy();

            subjectChart = new Chart(ctx, {
                type: 'bar', 
                data: chartData,
                options: {
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 14 }, 
                            bodyFont: { size: 12 }, 
                            padding: 10, 
                            cornerRadius: 6,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y} min`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: gridColor },
                            ticks: { color: primaryTextColor }
                        },
                        y: {
                            beginAtZero: true,
                            max: 70, // Max minutes on a day
                            title: {
                                display: true,
                                text: 'Minutes',
                                color: primaryTextColor
                            },
                            grid: { color: gridColor },
                            ticks: { color: primaryTextColor }
                        }
                    }
                }
            });
            // Removed doughnut specific code
        }
        
        const toast = document.getElementById('toast-notification'); const toastMessage = document.getElementById('toast-message'); function showToast(message, type = 'info') { toastMessage.textContent = message; toast.className = 'toast-notification'; void toast.offsetWidth; if (type === 'success') toast.classList.add('bg-green-600'); else if (type === 'error') toast.classList.add('bg-red-600'); else toast.classList.add('bg-blue-600'); toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }
        function handleLogout() { document.getElementById('logout-modal').classList.add('hidden'); showToast('Logged out successfully!', 'success'); setTimeout(() => navigateTo('page-home'), 500); }

        // --- Notification Toggle (Now opens Modal) ---
        function toggleNotificationDropdown(event) {
            event.stopPropagation(); // Prevent click from bubbling up
            document.getElementById('notification-modal').classList.remove('hidden');
        }


        // --- Assessment Page Setup Functions ---

        function setupReadingAssessmentPage() { 
            const passageElement = document.getElementById('reading-passage'); 
            if(passageElement){ 
                const randomIndex = Math.floor(Math.random() * readingPassages.length); 
                passageElement.textContent = readingPassages[randomIndex]; 
            } 
            resetRecordingState(); 
            const resultsDiv = document.getElementById('reading-assessment-results'); 
            if(resultsDiv) resultsDiv.classList.add('hidden'); 
        }

        function setupComprehensionAssessmentPage() { 
            selectedComprehensionFile = null; 
            const fileInput = document.getElementById('comprehension-file-input'); 
            if(fileInput) fileInput.value = ''; 

            // 1. Set Given Passage
            const passageElement = document.getElementById('comprehension-given-passage');
            if(passageElement) {
                const randomIndex = Math.floor(Math.random() * comprehensionPassages.length);
                passageElement.textContent = comprehensionPassages[randomIndex];
            }
            
            // 2. Set initial mode to upload (which populates the input area)
            setComprehensionMode('upload');

            const resultsDiv = document.getElementById('comprehension-assessment-results'); 
            if(resultsDiv) resultsDiv.classList.add('hidden'); 
        }

        function setComprehensionMode(mode) {
            currentComprehensionMode = mode;
            const inputArea = document.getElementById('comprehension-input-area');
            const uploadBtn = document.getElementById('mode-upload-btn');
            const writeBtn = document.getElementById('mode-write-btn');

            if (mode === 'upload') {
                uploadBtn?.classList.add('active');
                uploadBtn?.classList.remove('inactive');
                writeBtn?.classList.add('inactive');
                writeBtn?.classList.remove('active');
                
                inputArea.innerHTML = `
                    <div class="bg-gray-50 p-4 rounded-lg border text-center">
                        <p class="text-sm text-gray-800 mb-3">Upload a file (e.g., text, document, recording summary) containing Akash's response to the passage.</p>
                        <input type="file" id="comprehension-file-input" class="hidden" accept=".txt,.md,.pdf" onchange="handleFileSelect(event)">
                        <label for="comprehension-file-input" class="file-input-button"> 
                            <ion-icon name="cloud-upload-outline" class="text-xl"></ion-icon> Choose Response File 
                        </label>
                        <p id="comprehension-selected-filename" class="text-xs text-gray-500 mt-2">No file chosen</p>
                    </div>
                `;
                // Re-attach event listener if dynamic HTML insertion removed it
                document.getElementById('comprehension-file-input')?.addEventListener('change', handleFileSelect);

            } else { // 'write' mode
                uploadBtn?.classList.add('inactive');
                uploadBtn?.classList.remove('active');
                writeBtn?.classList.add('active');
                writeBtn?.classList.remove('inactive');
                
                inputArea.innerHTML = `
                    <div>
                        <textarea id="comprehension-text-area" rows="8" placeholder="Type Akash's summary or response here (Min. 50 words)..." class="w-full p-4 border border-gray-300 rounded-lg text-sm focus:ring-accent focus:border-accent resize-none"></textarea>
                        <p id="word-count-display" class="text-xs text-gray-600 text-right mt-1">0 words</p>
                    </div>
                `;
                // Re-attach event listener for dynamic text area
                document.getElementById('comprehension-text-area')?.addEventListener('input', checkComprehensionInput);
            }
            
            checkComprehensionInput();
        }


        function checkComprehensionInput() {
            const startButton = document.getElementById('start-comprehension-btn');
            let readyToStart = false;

            if (currentComprehensionMode === 'upload') {
                const filenameDisplay = document.getElementById('comprehension-selected-filename');
                readyToStart = selectedComprehensionFile !== null;
                if(filenameDisplay) filenameDisplay.textContent = selectedComprehensionFile ? selectedComprehensionFile.name : 'No file chosen';
            } else { // 'write' mode
                const textarea = document.getElementById('comprehension-text-area');
                const text = textarea?.value || '';
                const wordCount = text.trim().split(/\s+/).filter(word => word.length > 0).length;
                const wordCountDisplay = document.getElementById('word-count-display');
                if(wordCountDisplay) wordCountDisplay.textContent = `${wordCount} words (Min. ${MIN_COMPREHENSION_WORDS} required)`;
                readyToStart = wordCount >= MIN_COMPREHENSION_WORDS;
            }

            if (startButton) {
                startButton.disabled = !readyToStart;
                if (readyToStart) {
                    startButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    startButton.classList.add('bg-accent', 'hover:bg-accent-dark');
                } else {
                    startButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                    startButton.classList.remove('bg-accent', 'hover:bg-accent-dark');
                }
            }
        }

        function handleFileSelect(event) { 
            const fileInput = document.getElementById('comprehension-file-input');
            const file = fileInput?.files?.[0]; 
            selectedComprehensionFile = file || null;
            checkComprehensionInput();
        }

        function startComprehensionAssessment() { 
            if (currentComprehensionMode === 'upload' && !selectedComprehensionFile) {
                showToast("Please select a file first.", "error"); return;
            }
            const textarea = document.getElementById('comprehension-text-area');
            if (currentComprehensionMode === 'write' && (!textarea || textarea.value.trim().split(/\s+/).filter(word => word.length > 0).length < MIN_COMPREHENSION_WORDS)) {
                 showToast(`Please enter at least ${MIN_COMPREHENSION_WORDS} words in the response area.`, "error"); return;
            }

            const passageName = currentComprehensionMode === 'upload' ? selectedComprehensionFile.name : "Custom Text Response";

            showToast(`Submitting response for ${passageName}...`, "info"); 
            
            setTimeout(() => { 
                showToast("Assessment complete! Results below.", "success"); 
                const resultsDiv = document.getElementById('comprehension-assessment-results'); 
                if(resultsDiv){ 
                    resultsDiv.innerHTML = `<p class="font-medium text-gray-800 mb-1">Assessment Results:</p><p><strong class="text-blue-600">Strong comprehension!</strong> Score: 9/10. Akash correctly identified the main theme and character motivations. Missed one detail question about the setting. (Response: ${passageName})</p>`; 
                    resultsDiv.classList.remove('hidden'); 
                } 
            }, 2500); 
        }


        // --- Reading Fluency Recording (unchanged) ---
        function resetRecordingState() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') { mediaRecorder.stop(); }
            mediaRecorder = null; audioChunks = []; audioBlob = null;
            updateRecordingStatus('Idle');
            document.getElementById('start-record-btn')?.classList.remove('hidden');
            document.getElementById('pause-record-btn')?.classList.add('hidden');
            document.getElementById('resume-record-btn')?.classList.add('hidden');
            document.getElementById('stop-record-btn')?.classList.add('hidden');
            // Don't hide results here, only when starting a new assessment (in setup function)
        }
        function updateRecordingStatus(status) { const statusEl = document.getElementById('recording-status'); if (!statusEl) return; let content = ''; switch (status) { case 'Recording': content = `<span class="recording-dot mr-1"></span> Recording...`; break; case 'Paused': content = `<ion-icon name="pause-circle-outline" class="text-yellow-500 text-lg mr-1"></ion-icon> Paused`; break; case 'Processing': content = `<ion-icon name="hourglass-outline" class="text-blue-500 text-lg mr-1 animate-spin"></ion-icon> Processing...`; break; default: content = `<ion-icon name="mic-off-circle-outline" class="text-gray-500 text-lg mr-1"></ion-icon> Idle`; break; } statusEl.innerHTML = content; }
        async function startRecording() { try { const stream = await navigator.mediaDevices.getUserMedia({ audio: true }); mediaRecorder = new MediaRecorder(stream); mediaRecorder.ondataavailable = e => audioChunks.push(e.data); mediaRecorder.onstop = () => { audioBlob = new Blob(audioChunks, { type: 'audio/wav' }); audioChunks = []; updateRecordingStatus('Processing'); setTimeout(() => { showToast("Recording complete! Results below.", "success"); const resultsDiv = document.getElementById('reading-assessment-results'); if(resultsDiv){ resultsDiv.innerHTML = `<p class="font-medium text-gray-800 mb-1">Assessment Results:</p><p><strong class="text-green-600">Excellent fluency!</strong> Speed: 92 WPM (+4 WPM). Accuracy: 96%. Only minor hesitation on 'horizon'. Great job, Akash!</p>`; resultsDiv.classList.remove('hidden'); } resetRecordingState(); /* Reset UI after showing result */ }, 1500); stream.getTracks().forEach(track => track.stop()); }; mediaRecorder.start(); updateRecordingStatus('Recording'); document.getElementById('start-record-btn')?.classList.add('hidden'); document.getElementById('pause-record-btn')?.classList.remove('hidden'); document.getElementById('stop-record-btn')?.classList.remove('hidden'); document.getElementById('resume-record-btn')?.classList.add('hidden'); } catch (err) { console.error("Mic error:", err); showToast("Error: Could not access microphone.", "error"); resetRecordingState(); } }
        function pauseRecording() { if (mediaRecorder?.state === 'recording') { mediaRecorder.pause(); updateRecordingStatus('Paused'); document.getElementById('pause-record-btn')?.classList.add('hidden'); document.getElementById('resume-record-btn')?.classList.remove('hidden'); } }
        function resumeRecording() { if (mediaRecorder?.state === 'paused') { mediaRecorder.resume(); updateRecordingStatus('Recording'); document.getElementById('pause-record-btn')?.classList.remove('hidden'); document.getElementById('resume-record-btn')?.classList.add('hidden'); } }
        function stopRecording() { if (mediaRecorder && (mediaRecorder.state === 'recording' || mediaRecorder.state === 'paused')) { mediaRecorder.stop(); /* onstop handles UI */ } }
        
        // --- Report Download Authorization Check ---
        function checkReportAuthorization(reportName) {
            // Simulated check: Only "Weekly Summary" is authorized for download.
            // Other reports (Monthly Deep Dive, Reading & Comprehension) trigger an error.
            if (reportName.includes('Weekly Summary')) {
                return { authorized: true, message: "Download started." };
            } else {
                return { authorized: false, message: `Download Unauthorized: Downloading "${reportName}" requires higher administrative permissions.` };
            }
        }
        
        function handleReportDownload(reportName, dateRange) {
            const authResult = checkReportAuthorization(reportName);
            if (authResult.authorized) {
                showToast(`Downloading: ${reportName} (${dateRange})...`, 'info');
            } else {
                showToast(authResult.message, 'error');
            }
        }

        // --- Recommended Actions Handlers ---
        function handleViewTips() {
            document.getElementById('tips-modal-content').innerHTML = comprehensionTips;
            document.getElementById('recommended-tips-modal').classList.remove('hidden');
        }

        async function handleFindPassages() {
            // 1. Prepare UI for loading
            const reportModalTitle = document.getElementById('report-modal-title');
            reportModalTitle.textContent = "Generating Practice Passage";
            reportContent.innerHTML = `
                <div class="flex flex-col items-center justify-center p-12 text-center text-gray-600">
                    <ion-icon name="document-text-outline" class="text-4xl text-accent animate-pulse mb-3"></ion-icon>
                    <p class="font-semibold text-lg text-gray-900">Generating Practice Passage...</p>
                    <p class="text-sm">Please wait while the AI crafts a suitable reading text for complex sentences.</p>
                </div>
            `;
            document.getElementById('report-modal').classList.remove('hidden');
            showToast("Generating complex sentences practice...", 'info'); 
            
            // 2. Call Gemini API for passage
            await callGeminiAPI(null, 'passage');
        }


        // --- Report Generation ---
        const reportModal = document.getElementById('report-modal'); 
        const reportContent = document.getElementById('report-content'); 
        function handleGenerateReport() { 
            // 1. Set loading state in modal
            const reportModalTitle = document.getElementById('report-modal-title');
            reportModalTitle.textContent = "AI-Generated Progress Report";

            reportContent.innerHTML = `
                <div class="flex flex-col items-center justify-center p-12 text-center text-gray-600">
                    <ion-icon name="document-text-outline" class="text-4xl text-accent animate-pulse mb-3"></ion-icon>
                    <p class="font-semibold text-lg text-gray-900">Generating Report...</p>
                    <p class="text-sm">Please wait while the AI compiles Akash's data.</p>
                </div>
            `;
            // 2. Show Modal and Toast
            reportModal.classList.remove('hidden');
            showToast("Generating comprehensive progress report..."); 
            // 3. Call API
            callGeminiAPI(null, 'report'); 
        }
        
        // --- Content Generator Functions ---
        
        async function handleGenerateContent() {
            const userPromptEl = document.getElementById('generator-prompt');
            const contentTypeEl = document.getElementById('content-type-selector');
            const generateBtn = document.getElementById('generate-content-btn');
        
            const userPrompt = userPromptEl?.value.trim();
            const contentType = contentTypeEl?.value;
        
            if (!userPrompt || userPrompt.length < 10) {
                showToast("Please enter a longer, more detailed prompt (min 10 characters).", "error");
                return;
            }
        
            // Hide initial message
            document.getElementById('initial-message')?.classList.add('hidden');

            // Set loading state
            generateBtn.disabled = true;
            generateBtn.classList.add('bg-gray-500', 'cursor-wait', 'animate-pulse');
            generateBtn.classList.remove('bg-accent', 'hover:bg-accent-dark');
            generateBtn.innerHTML = '<ion-icon name="sync-outline" class="text-xl animate-spin"></ion-icon> Generating...';
            
            // Show loading in results area
            displayGeneratedContent('loading', contentType);
            
            showToast(`Generating ${contentType.toLowerCase()}...`, 'info');
            
            // Call API with specific prompt and type
            const combinedPrompt = `${CONTENT_GENERATOR_PROMPT}\n\n**USER REQUEST:**\nContent Type: ${contentType}\nTopic/Query: ${userPrompt}`;
            
            await callGeminiAPI(combinedPrompt, 'generate-content');
        }
        
        function displayGeneratedContent(content, contentType = 'AI Content') {
            const resultsArea = document.getElementById('generated-content-results');
            const generateBtn = document.getElementById('generate-content-btn');
            
            if (!resultsArea || !generateBtn) return;
            
            resultsArea.classList.remove('bg-red-100', 'border-red-500', 'text-red-700', 'p-4', 'bg-gray-50', 'rounded-lg', 'border'); // Clean previous styles
            resultsArea.classList.add('bg-white', 'p-6', 'rounded-xl', 'shadow-md');

            if (content === 'loading') {
                resultsArea.innerHTML = `
                    <div class="flex flex-col items-center justify-center p-8 text-center text-gray-600">
                        <ion-icon name="cube-outline" class="text-4xl text-accent animate-spin mb-3"></ion-icon>
                        <p class="font-semibold text-lg text-gray-900">Crafting your ${contentType}...</p>
                        <p class="text-sm">This may take a few moments. Hang tight!</p>
                    </div>
                `;
                resultsArea.classList.remove('hidden');
                return;
            }

            // Reset button state
            generateBtn.disabled = false;
            generateBtn.classList.remove('bg-gray-500', 'cursor-wait', 'animate-pulse');
            generateBtn.classList.add('bg-accent', 'hover:bg-accent-dark');
            generateBtn.innerHTML = '<ion-icon name="sparkles-outline" class="text-xl"></ion-icon> Generate Content';

            if (content.error) {
                resultsArea.classList.remove('bg-white', 'p-6', 'rounded-xl', 'shadow-md');
                resultsArea.classList.add('bg-red-100', 'border-l-4', 'border-red-500', 'text-red-700', 'p-4');
                resultsArea.innerHTML = `
                    <p class="font-bold">Error Generating Content</p>
                    <p class="text-sm">${content.message}</p>
                `;
            } else {
                resultsArea.innerHTML = `<h2 class="text-xl font-bold mb-4">Your Generated ${contentType}</h2>` + simpleMarkdownToHtml(content);
            }
            resultsArea.classList.remove('hidden');
        }
        
        // --- Markdown to HTML Helper (Used by Reports and Content Generator) ---
        function simpleMarkdownToHtml(text) { 
            let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                         .replace(/\*(.*?)\*/g, '<em>$1</em>')
                         .replace(/^# (.*$)/gm, '<h1 class="text-xl font-bold mb-2">$1</h1>')
                         .replace(/^## (.*$)/gm, '<h2 class="text-lg font-semibold mb-2">$1</h2>')
                         .replace(/^### (.*$)/gm, '<h3 class="text-md font-semibold mb-1">$1</h3>')
                         .replace(/^[-*] (.*$)/gm, '<li class="ml-4 list-disc">$1</li>');
        
            // Handle list grouping
            html = html.replace(/<\/li>\s*<li/gs, '</li><li');
            html = html.replace(/(?<!<\/ul>)\n*<ul>/g, '<ul>');
            html = html.replace(/<\/li>\s*<h/g, '</li></ul><h'); // End list before new heading
            
            // Simple paragraph wrapping
            html = html.split('\n\n').map(p => {
                p = p.trim();
                if (!p) return '';
                // Check if it's already a block tag (heading, list, div)
                if (p.startsWith('<h') || p.startsWith('<ul') || p.startsWith('<div')) return p.replace(/\n/g, '<br>');
                return `<p>${p.replace(/\n/g, '<br>')}</p>`;
            }).join('');
            
            html = html.replace(/<ul>\s*<ul>/g, '<ul>'); // Fix extra list tags
            html = html.replace(/<\/ul>\s*<\/ul>/g, '</ul>');
            html = html.replace(/<p>\s*<\/p>/g, ''); // Remove empty paragraphs
            return html; 
        }


        // --- GEMINI API (UPDATED for 'generate-content') ---
        async function exponentialBackoff(fetchFn, maxRetries = 5, baseDelay = 1000) { 
            let attempt = 0; 
            while (attempt < maxRetries) { 
                try { 
                    const response = await fetchFn(); 
                    if (response.ok) { return await response.json(); } 
                    if (response.status >= 400 && response.status < 500) { 
                        console.error("Client error:", response.status); 
                        try { 
                            const errorData = await response.json(); 
                            return { error: true, message: errorData.error?.message || "API error" }; 
                        } catch (e) { 
                            return { error: true, message: `API error: ${response.statusText}` }; 
                        } 
                    } 
                } catch (error) { 
                    console.error(`Attempt ${attempt + 1} network error:`, error); 
                } 
                attempt++; 
                if (attempt >= maxRetries) { 
                    console.error("Max retries."); 
                    return { error: true, message: "Max retries reached." }; 
                } 
                const delay = baseDelay * Math.pow(2, attempt - 1) + (Math.random() * 1000); 
                await new Promise(resolve => setTimeout(resolve, delay)); 
            } 
            return { error: true, message: "Max retries after network errors." }; 
        }
        
        async function callGeminiAPI(userInput, mode) { 
            const apiKey = ""; // Left empty as per instructions
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`; 
            let payload; 
            let promptToSend;
            
            if (mode === 'chat') { 
                if(userInput) chatHistory.push({ role: "user", parts: [{ text: userInput }] }); 
                const historyToSend = chatHistory.filter(msg => msg.role !== 'system'); 
                payload = { contents: historyToSend, systemInstruction: { parts: [{ text: CHAT_SYSTEM_PROMPT }] } }; 
            } else if (mode === 'report') { 
                const reportType = document.getElementById('report-type')?.value || 'Weekly Summary'; 
                const reportRange = document.getElementById('report-range')?.value || 'Last 7 Days'; 
                promptToSend = `${REPORT_PROMPT}\nPlease generate a "${reportType}" for the "${reportRange}". Tailor insights. Use Markdown.`; 
                payload = { contents: [{ parts: [{ text: promptToSend }] }] }; 
            } else if (mode === 'passage') {
                promptToSend = PASSAGE_PROMPT;
                payload = { contents: [{ parts: [{ text: promptToSend }] }] };
            } else if (mode === 'generate-content') { // NEW MODE
                promptToSend = userInput; // User input here is the combined system + user prompt
                payload = { contents: [{ parts: [{ text: promptToSend }] }] };
            }
            
            const fetchFn = () => fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); 
            try { 
                const result = await exponentialBackoff(fetchFn); 
                if (!result || result.error) throw new Error(result?.message || "API call failed."); 
                const candidate = result.candidates?.[0]; 
                const text = candidate?.content?.parts?.[0]?.text; 
                
                if (!text) { 
                    const safety = candidate?.safetyRatings; 
                    const reason = candidate?.finishReason; 
                    if (reason === "SAFETY" || reason === "RECITATION" || (safety && safety.some(r => r.block))) throw new Error("Blocked: safety/policy."); 
                    else if (reason) throw new Error(`API finished: ${reason}`); 
                    else if (!candidate?.content) throw new Error("Blocked or invalid (no content)."); 
                    else throw new Error("Invalid response (no text)."); 
                } 
                
                if (mode === 'chat') { 
                    chatHistory.push({ role: "model", parts: [{ text: text }] }); 
                    const thinkBubble = document.getElementById('thinking-bubble'); 
                    if (thinkBubble) { 
                        thinkBubble.textContent = text; 
                        thinkBubble.classList.remove('thinking'); 
                        thinkBubble.id = ''; 
                    } else addChatMessage(text, 'ai'); 
                } else if (mode === 'report') { 
                    showToast("Report Generated!", "success"); 
                    reportContent.innerHTML = simpleMarkdownToHtml(text); 
                    reportModal.classList.remove('hidden'); 
                } else if (mode === 'passage') {
                    showToast("Passage Generated!", "success");
                    // Format the passage text for display
                    reportContent.innerHTML = `
                        <h4 class="text-lg font-bold text-gray-900 mb-2">Generated Practice Passage:</h4>
                        <p class="text-xs text-gray-500 mb-4">Focus on complex words and comprehension when reading this text.</p>
                        <div class="bg-white p-4 rounded-lg border border-accent/30 shadow-inner">
                            <p class="text-base text-gray-800 whitespace-pre-wrap">${text}</p>
                        </div>
                    `;
                    reportModal.classList.remove('hidden');
                } else if (mode === 'generate-content') { // NEW: Handle Content Generation result
                    const contentTypeEl = document.getElementById('content-type-selector');
                    const contentType = contentTypeEl?.value || 'AI Content';
                    showToast("Content Generated!", "success");
                    displayGeneratedContent(text, contentType);
                }
            } catch (error) { 
                console.error("Gemini API Error:", error); 
                const errorMsg = `Error: ${error.message || "Failed."}`; 
                if (mode === 'chat') { 
                    const thinkBubble = document.getElementById('thinking-bubble'); 
                    if (thinkBubble) { 
                        thinkBubble.textContent = `Sorry, error. ${errorMsg}`; 
                        thinkBubble.classList.remove('thinking'); 
                        thinkBubble.id = ''; 
                    } else addChatMessage(`Sorry, error. ${errorMsg}`, 'ai'); 
                    if (userInput) chatHistory.pop(); 
                } else if (mode === 'report' || mode === 'passage') {
                    // Update the modal with an error message on failure
                    reportContent.innerHTML = `
                        <div class="flex flex-col items-center justify-center p-12 text-center text-gray-600">
                            <ion-icon name="warning-outline" class="text-4xl text-red-500 mb-3"></ion-icon>
                            <p class="font-semibold text-lg text-gray-900">${mode === 'report' ? 'Report' : 'Passage'} Generation Failed</p>
                            <p class="text-sm text-red-600">${errorMsg}</p>
                            <p class="text-xs mt-2 text-gray-500">Please try again later.</p>
                        </div>
                    `;
                    showToast(errorMsg, 'error');
                } else if (mode === 'generate-content') { // NEW: Handle Content Generation Error
                    const contentTypeEl = document.getElementById('content-type-selector');
                    const contentType = contentTypeEl?.value || 'AI Content';
                    displayGeneratedContent({ error: true, message: errorMsg }, contentType);
                }
            } 
        }


        // --- Theme Toggle ---
        const themeToggle = document.getElementById('theme-toggle');
        const applyTheme = (isDark) => {
            if (isDark) { document.documentElement.classList.add('dark'); }
            else { document.documentElement.classList.remove('dark'); }
            // Re-render chart if visible to potentially update colors (e.g., border, axis text)
            if (document.getElementById('page-progress')?.classList.contains('active')) {
                renderSubjectChart();
                renderSkillProgress(); // Re-render skill bars to apply new colors
            }
        };

        themeToggle?.addEventListener('change', (e) => {
            const isDark = e.target.checked;
            applyTheme(isDark);
            localStorage.setItem('soundslate-theme', isDark ? 'dark' : 'light');
        });


        // --- Chat Functions (needed for chat API usage) ---
        
        function toggleChat() {
            document.getElementById('chat-widget').classList.toggle('hidden');
        }
        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex');
            messageDiv.innerHTML = `<div class="chat-bubble ${sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}">${message}</div>`;
            if (sender === 'user') messageDiv.classList.add('justify-end');
            
            if (sender === 'ai' && message === '...') {
                messageDiv.querySelector('.chat-bubble').classList.add('thinking');
                messageDiv.querySelector('.chat-bubble').id = 'thinking-bubble';
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
        }
        document.getElementById('chat-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (message === '') return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            // Add thinking bubble before calling API
            addChatMessage('...', 'ai');
            
            await callGeminiAPI(message, 'chat');
        });


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Apply saved theme or default to LIGHT (per user request)
            const savedTheme = localStorage.getItem('soundslate-theme');
            const isDark = savedTheme === 'dark'; 
            
            if (themeToggle) themeToggle.checked = isDark;
            applyTheme(isDark); // Apply the theme immediately

            // Set user names, avatars, etc. (unchanged)
            document.querySelectorAll('[id^="user-name-"]').forEach(el => el.textContent = `Hi, ${currentUserName}!`);
            document.querySelectorAll('[id^="user-avatar-"]').forEach(el => el.textContent = currentUserName.charAt(0).toUpperCase());
            const welcomeBanner = document.getElementById('welcome-banner');
            if(welcomeBanner) welcomeBanner.textContent = `Welcome back, ${currentUserName}!`;
            if(document.getElementById('progress-welcome')) document.getElementById('progress-welcome').textContent = `Hi ${currentUserName}!`;

            // Initial render and navigation
            renderSubjectChart(); // Render initially even if hidden
            navigateTo('page-home'); // Set initial page
            // We ensure renderSkillProgress is called inside navigateTo('page-progress') or applyTheme

            // Initialize chat history (unchanged)
            const initialGreeting = "Hi! I'm Boo. How can I help you understand Akash's reading and comprehension progress today?";
            // Ensure chat history is reset on page load for consistent API calls
            chatHistory = [{ role: "user", parts: [{ text: "Hello" }] }, { role: "model", parts: [{ text: initialGreeting }] }];
            const aiBubble = document.querySelector('#chat-messages .chat-bubble-ai'); if(aiBubble) aiBubble.textContent = initialGreeting;
        });
    </script>
</body>
</html>
